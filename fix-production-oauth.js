// 生产环境 OAuth 问题解决指南
console.log('🚀 生产环境 OAuth 问题解决方案')

console.log('\n❌ 你遇到的问题:')
console.log('  线上部署后，OAuth 回调跳转到了:')
console.log('  http://localhost:3000/#access_token=...')
console.log('  这说明 Supabase 配置中的重定向 URL 不正确')

console.log('\n🎯 问题根源:')
console.log('  1. Supabase 控制台的 Site URL 仍然是 localhost')
console.log('  2. Supabase 控制台的 Redirect URLs 配置不正确')
console.log('  3. OAuth 应用的回调 URL 可能配置错误')

console.log('\n✅ 立即解决方案:')
console.log('  1. 登录 Supabase 控制台: https://supabase.com/dashboard')
console.log('  2. 进入你的项目 > Authentication > URL Configuration')
console.log('  3. 更新配置:')
console.log('     Site URL: https://your-production-domain.com')
console.log('     Redirect URLs:')
console.log('       - https://your-production-domain.com/auth/callback')
console.log('       - http://localhost:5173/auth/callback (保留开发用)')
console.log('  4. 保存配置')

console.log('\n🔧 已创建的解决工具:')
console.log('  ✅ src/utils/environment.ts - 智能环境检测')
console.log('  ✅ src/views/ConfigCheck.vue - 配置检查页面')
console.log('  ✅ PRODUCTION_OAUTH_SETUP.md - 详细配置指南')
console.log('  ✅ 优化的 SocialLogin 组件 - 智能重定向 URL')

console.log('\n🧪 测试工具:')
console.log('  访问 /config-check 页面查看:')
console.log('  - 当前环境信息')
console.log('  - 计算的重定向 URL')
console.log('  - Supabase 配置状态')
console.log('  - 配置建议')

console.log('\n📋 配置检查清单:')
console.log('  □ Supabase Site URL 设置为生产域名')
console.log('  □ Supabase Redirect URLs 包含生产域名')
console.log('  □ GitHub OAuth 应用 Homepage URL 正确')
console.log('  □ GitHub OAuth 应用 Callback URL 是 Supabase 地址')
console.log('  □ Google OAuth 应用 JavaScript origins 正确')
console.log('  □ Google OAuth 应用 Redirect URIs 是 Supabase 地址')
console.log('  □ 生产环境变量 VITE_SUPABASE_URL 正确')
console.log('  □ 生产环境变量 VITE_SUPABASE_ANON_KEY 正确')

console.log('\n🔍 调试步骤:')
console.log('  1. 访问 https://your-domain.com/config-check')
console.log('  2. 检查显示的环境信息是否正确')
console.log('  3. 复制显示的配置信息到 Supabase 控制台')
console.log('  4. 测试 OAuth 登录按钮')
console.log('  5. 检查浏览器控制台的日志信息')

console.log('\n⚡ 快速修复:')
console.log('  如果你的生产域名是 https://example.com，则:')
console.log('  Supabase Site URL: https://example.com')
console.log('  Supabase Redirect URLs:')
console.log('    - https://example.com/auth/callback')
console.log('    - http://localhost:5173/auth/callback')

console.log('\n🎯 关键提示:')
console.log('  - Site URL 必须是你的生产域名')
console.log('  - Redirect URLs 必须包含生产域名的回调地址')
console.log('  - OAuth 应用的回调 URL 必须是 Supabase 的地址')
console.log('  - 配置更新后可能需要几分钟生效')

console.log('\n📚 相关文档:')
console.log('  - PRODUCTION_OAUTH_SETUP.md - 完整配置指南')
console.log('  - /config-check - 配置检查工具')
console.log('  - Supabase 文档: https://supabase.com/docs/guides/auth')

console.log('\n🚀 配置完成后:')
console.log('  1. 清除浏览器缓存')
console.log('  2. 重新测试 OAuth 登录')
console.log('  3. 验证回调 URL 是否正确')
console.log('  4. 检查用户信息是否正确获取')

console.log('\n💡 预防措施:')
console.log('  - 为开发和生产环境使用不同的 Supabase 项目')
console.log('  - 定期检查和更新 OAuth 配置')
console.log('  - 监控 OAuth 登录成功率')
console.log('  - 设置错误日志和告警')

console.log('\n🎉 修复完成后，你将拥有:')
console.log('  ✅ 正常工作的生产环境 OAuth 登录')
console.log('  ✅ 智能的环境检测和配置')
console.log('  ✅ 完善的错误处理和调试工具')
console.log('  ✅ 开发和生产环境的无缝切换')

console.log('\n🔧 立即行动: 访问 Supabase 控制台更新配置！')